<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragmentos/head :: head('Marcas • Listagem')}"></head>
<body>
<!-- Header com navegação -->
<header th:replace="~{fragmentos/header :: header(activePage='marca')}"></header>

<div class="container" style="max-width: 1000px;">
    <!-- Barra de ações CRUD exigidas -->
    <div class="section" style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap;">
        <h4 class="teal-text text-darken-3" style="margin:0;">Marcas</h4>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <a class="btn teal" th:href="@{/marca/formulario}"><i class="material-icons left">add</i>Adicionar</a>
            <a class="btn teal" href="#" id="btn-buscar"><i class="material-icons left">search</i>Buscar</a>
            <a class="btn teal" href="#" id="btn-modificar"><i class="material-icons left">edit</i>Modificar</a>
            <a class="btn teal" href="#" id="btn-remover"><i class="material-icons left">delete</i>Remover</a>
            <a class="btn teal" th:href="@{/marca}"><i class="material-icons left">list</i>Listar Todos</a>
            <a class="btn-flat" th:href="@{/}"><i class="material-icons left">home</i>Voltar</a>
        </div>
    </div>

    <!-- Campo de filtro local (cliente) -->
    <div class="input-field">
        <input id="filtro" type="text" placeholder="Filtrar por nome/país" />
        <label for="filtro">Buscar</label>
    </div>

    <div class="card">
        <div class="card-content">
            <span class="card-title">Lista de Marcas</span>
            <div class="responsive-table">
                <table class="highlight responsive-table">
                    <thead>
                    <tr>
                        <th>Nome</th>
                        <th>País</th>
                        <th style="width:140px">Ações</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="marca : ${lista}">
                        <td th:text="${marca.nome}"></td>
                        <td th:text="${marca.pais}"></td>
                        <td style="display:flex; gap:8px;">
                            <!-- Editar -->
                            <a class="btn-flat waves-effect tooltipped" data-position="top" data-tooltip="Editar"
                               th:href="@{/marca/formulario(id=${marca.id})}">
                                <i class="material-icons">edit</i>
                            </a>
                            <!-- Excluir (usa _method=delete para o controller @DeleteMapping) -->
                            <form th:action="@{/marca}" method="post" onsubmit="return confirm('Deseja realmente excluir?');">
                                <input type="hidden" name="_method" value="delete">
                                <input type="hidden" name="id" th:value="${marca.id}">
                                <button type="submit" class="btn-flat waves-effect red-text tooltipped" data-position="top" data-tooltip="Excluir">
                                    <i class="material-icons">delete</i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Estado vazio -->
    <div th:if="${#lists.isEmpty(lista)}" class="card-panel yellow lighten-4">
        Nenhuma marca cadastrada. Clique em "Novo" para adicionar uma.
    </div>
</div>

<!-- Rodapé e scripts -->
<div th:replace="~{fragmentos/footer :: footer}"></div>
<form th:action="@{/marca}" method="post" id="form-del" style="display:none;">
    <input type="hidden" name="_method" value="delete">
    <input type="hidden" name="id" id="del-id">
</form>
<script>
    document.addEventListener('DOMContentLoaded', function(){
        const filtro = document.getElementById('filtro');
        filtro && filtro.addEventListener('input', function(){
            const term = this.value.toLowerCase();
            document.querySelectorAll('tbody tr').forEach(tr => {
                const txt = tr.innerText.toLowerCase();
                tr.style.display = txt.includes(term) ? '' : 'none';
            });
        });

        // Modificar por ID (abre formulário com id como query param)
        const mod = document.getElementById('btn-modificar');
        mod && mod.addEventListener('click', function(e){ e.preventDefault(); const id = prompt('Digite o ID da marca para editar:'); if(id){ window.location.href = `${(window.location.pathname.startsWith('/frota')?'/frota':'')}/marca/formulario?id=${id}`; }});

        // Remover por ID (usa _method=delete)
        const rem = document.getElementById('btn-remover');
        rem && rem.addEventListener('click', function(e){
            e.preventDefault();
            const id = prompt('Digite o ID da marca para remover:');
            if(id && confirm('Confirmar remoção?')){
                document.getElementById('del-id').value = id;
                document.getElementById('form-del').submit();
            }
        });

        // Foco na busca ao clicar
        const btnBuscar = document.getElementById('btn-buscar');
        btnBuscar && btnBuscar.addEventListener('click', function(e){ e.preventDefault(); const f = document.getElementById('filtro'); f && f.focus(); });
    });
</script>
</body>
</html>